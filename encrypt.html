<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>CipherCraft — encrypt.html demo</title>
    <!-- Tailwind Play CDN for quick styling (demo only) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React + ReactDOM UMD builds -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel for in-browser JSX transpilation (only for quick demos) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>body{min-height:100vh}</style>
  </head>
  <body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel">
      const { useState } = React;

      // Single-file React component in an HTML file for quick demo
      function EncryptionApp() {
        const users = [
          { username: "swetha", password: "642004" },
          { username: "adithyan", password: "532005" },
          { username: "nandu", password: "1432005" },
          { username: "arjun", password: "2662005" },
        ];

        const [user, setUser] = useState(null);
        const [loginInput, setLoginInput] = useState({ username: "", password: "" });
        const [loginError, setLoginError] = useState("");

        const [message, setMessage] = useState("");
        const [cipherText, setCipherText] = useState("");
        const [result, setResult] = useState("");

        const letterToNumber = (ch) => {
          const up = ch.toUpperCase();
          const code = up.charCodeAt(0);
          if (code >= 65 && code <= 90) return code - 64;
          return null;
        };

        const numberToLetter = (n) => {
          if (n >= 1 && n <= 26) return String.fromCharCode(64 + n);
          return "?";
        };

        const encrypt = (plain) => {
          // Build an array of letter values to compute the total (letters only)
          const letterValues = [];
          for (let i = 0; i < plain.length; i++) {
            const v = letterToNumber(plain[i]);
            if (v != null) letterValues.push(v);
          }

          const total = letterValues.reduce((acc, v) => acc + v, 0);

          // Build tokens preserving non-letter characters (spaces/punctuation) as literal tokens
          const tokens = [];
          for (let i = 0; i < plain.length; i++) {
            const ch = plain[i];
            const v = letterToNumber(ch);
            if (v != null) {
              tokens.push(String(v + total));
            } else {
              // keep spaces and punctuation as-is (single-char tokens)
              tokens.push(ch);
            }
          }

          const joined = tokens.join("");
          const reversed = joined.split("").reverse().join("");

          // Note: cipherText is kept for debugging but no longer shown in UI by default
          setCipherText(`Total=${total}  |  tokens=${tokens.join(",")}  |  joined=${joined}  |  final(reversed)=${reversed}`);
          setResult(reversed);
          return reversed;
        };

        const decrypt = (cipher) => {
          const unreversed = cipher.split("").reverse().join("");

          function attemptParse(unrev, assumedTotal) {
            const letters = [];
            let i = 0;
            while (i < unrev.length) {
              if (!/\d/.test(unrev[i])) {
                letters.push(unrev[i]);
                i++;
                continue;
              }

              let parsed = null;
              for (let len = 3; len >= 1; len--) {
                const part = unrev.substr(i, len);
                if (part.length < 1) continue;
                if (!/^\d+$/.test(part)) continue;
                const num = parseInt(part, 10);
                const original = num - assumedTotal;
                if (original >= 1 && original <= 26) {
                  parsed = { ch: numberToLetter(original), len };
                  break;
                }
              }
              if (!parsed) return null;
              letters.push(parsed.ch);
              i += parsed.len;
            }
            return letters.join("");
          }

          for (let t = 1; t <= 400; t++) {
            const attempt = attemptParse(unreversed, t);
            if (attempt) {
              const sum = attempt
                .split("")
                .filter((c) => /[A-Z]/i.test(c))
                .reduce((acc, ch) => acc + (letterToNumber(ch) || 0), 0);
              if (sum === t) {
                setResult(attempt);
                setCipherText(`Inferred total=${t} | unreversed=${unreversed}`);
                return attempt;
              }
            }
          }

          setResult("Failed to decrypt: ambiguous or invalid cipher for this algorithm");
          setCipherText(`unreversed=${unreversed}`);
          return null;
        };

        const handleEncryptClick = () => {
          if (!message.trim()) return;
          encrypt(message);
        };

        const handleDecryptClick = () => {
          if (!message.trim()) return;
          decrypt(message);
        };

        const handleLogin = (e) => {
          e.preventDefault();
          setLoginError("");
          const found = users.find(
            (u) => u.username.toLowerCase() === loginInput.username.toLowerCase() && u.password === loginInput.password
          );
          if (found) {
            setUser(found.username);
            setLoginInput({ username: "", password: "" });
          } else {
            setLoginError("Invalid username or password. Try a demo account.");
          }
        };

        const handleLogout = () => {
          setUser(null);
          setMessage("");
          setCipherText("");
          setResult("");
        };

        return (
          <div className="min-h-screen bg-gradient-to-br from-indigo-600 to-purple-600 text-gray-900 flex items-center justify-center p-6">
            <div className="w-full max-w-4xl bg-white/90 backdrop-blur-md rounded-3xl shadow-2xl overflow-hidden">
              <div className="md:flex">
                <div className="md:w-1/2 p-10 bg-gradient-to-b from-white to-indigo-50">
                  <div className="text-center mb-6">
                    <h1 className="text-3xl font-extrabold text-indigo-700">CipherCraft</h1>
                    <p className="text-sm text-indigo-600/80 mt-1">Custom encrypt & decrypt — single page app</p>
                  </div>

                  {!user ? (
                    <form onSubmit={handleLogin} className="space-y-4">
                      <div>
                        <label className="block text-sm font-medium text-indigo-700">Username</label>
                        <input
                          value={loginInput.username}
                          onChange={(e) => setLoginInput({ ...loginInput, username: e.target.value })}
                          placeholder="username"
                          className="mt-1 block w-full rounded-lg border border-indigo-200 px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-300"
                        />
                      </div>
                      <div>
                        <label className="block text-sm font-medium text-indigo-700">Password</label>
                        <input
                          type="password"
                          value={loginInput.password}
                          onChange={(e) => setLoginInput({ ...loginInput, password: e.target.value })}
                          placeholder="Enter password"
                          className="mt-1 block w-full rounded-lg border border-indigo-200 px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-300"
                        />
                      </div>
                      {loginError && <div className="text-sm text-red-600">{loginError}</div>}
                      <div className="flex items-center justify-between">
                        <button
                          type="submit"
                          className="rounded-full bg-indigo-600 text-white px-6 py-2 font-semibold shadow hover:bg-indigo-700"
                        >
                          Sign in
                        </button>

                        <div className="text-xs text-gray-500">Demo accounts available</div>
                      </div>

                      <div className="mt-4 text-sm text-gray-600">
                        <strong>Tip:</strong> This demo stores credentials locally in the UI for simplicity.
                      </div>
                    </form>
                  ) : (
                    <div className="space-y-3">
                      <div className="flex items-center justify-between">
                        <div>
                          <div className="text-sm text-gray-500">Signed in as</div>
                          <div className="text-lg font-semibold text-indigo-700">{user}</div>
                        </div>
                        <button onClick={handleLogout} className="text-sm text-indigo-600 hover:underline">Logout</button>
                      </div>

                      <div className="rounded-lg border border-indigo-100 p-3 bg-indigo-50">
                        <div className="text-sm text-indigo-700 font-medium">Quick instructions</div>
                        <ul className="text-xs text-indigo-600 mt-2 space-y-1">
                          <li>• Type a short message (letters only recommended).</li>
                          <li>• Use Encrypt to see the numeric tokens and reversed final cipher.</li>
                          <li>• Use Decrypt to attempt recovery (best-effort).</li>
                        </ul>
                      </div>
                    </div>
                  )}
                </div>

                <div className="md:w-1/2 p-8">
                  <div className="flex items-center justify-between">
                    <h2 className="text-xl font-semibold text-indigo-800">Encrypt & Decrypt</h2>
                  </div>

                  <div className="mt-4">
                    <textarea
                      rows="4"
                      className="w-full rounded-lg border border-gray-200 p-3 focus:ring-2 focus:ring-indigo-200"
                      placeholder={user ? "Type message or cipher here..." : "Sign in to use the tool"}
                      value={message}
                      onChange={(e) => setMessage(e.target.value)}
                      disabled={!user}
                    />

                    <div className="mt-3 flex gap-3">
                      <button
                        onClick={handleEncryptClick}
                        disabled={!user}
                        className="flex-1 rounded-lg bg-indigo-600 text-white py-2 font-medium hover:bg-indigo-700 disabled:opacity-50"
                      >
                        Encrypt
                      </button>
                      <button
                        onClick={handleDecryptClick}
                        disabled={!user}
                        className="flex-1 rounded-lg bg-gray-100 text-gray-800 py-2 font-medium hover:bg-gray-200 disabled:opacity-50"
                      >
                        Decrypt
                      </button>
                    </div>

                    <div className="mt-4 p-4 rounded-lg bg-indigo-50 border border-indigo-100">
                      <div className="text-xs text-gray-500">Result</div>
                      <div className="mt-2 text-lg font-mono text-indigo-900 break-words">{result || "—"}</div>
                    </div>
                    
                  </div>
                </div>
              </div>

              <div className="p-4 text-center text-xs text-gray-600 bg-white/70">
                  CipherCraft • simple educational demo
                </div>
            </div>
          </div>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<EncryptionApp />);
    </script>
  </body>
</html>